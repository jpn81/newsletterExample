<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Newsletter — Latest Articles</title>
  <style>
    :root{--brand:#081A35;--text:#0f172a;--muted:#475569;--line:#e5e7eb;--card:#fff;--bg:#fff}
    .nl{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,Noto Sans,"Apple Color Emoji","Segoe UI Emoji";color:var(--text);background:var(--bg)}
    .wrap{max-width:940px;margin:0 auto;padding:24px}
    h1{margin:0 0 8px;font-size:clamp(1.6rem,1rem+2vw,2.2rem)}
    .sub{color:var(--muted);margin:0 0 16px}
    .grid{display:grid;gap:16px}
    .card{display:grid;grid-template-columns:120px 1fr;gap:14px;border:1px solid var(--line);border-radius:12px;background:var(--card);padding:12px;align-items:center}
    .thumb{width:100%;aspect-ratio:16/10;object-fit:cover;border-radius:8px;border:1px solid var(--line);background:#f8fafc}
    .meta{display:flex;gap:8px;flex-wrap:wrap;color:var(--muted);font-size:.9rem;margin:4px 0}
    .title{margin:0 0 4px;font-size:1.1rem;line-height:1.35}
    .excerpt{margin:0 0 10px;color:#111827;line-height:1.55}
    .row{display:flex;gap:10px;flex-wrap:wrap}
    .btn{appearance:none;border:1px solid var(--line);background:#fff;border-radius:10px;padding:8px 12px;text-decoration:none;color:var(--brand);font-weight:600}
    .btn:hover{box-shadow:0 1px 6px rgba(0,0,0,.08)}
    .pill{border:1px dashed var(--line);border-radius:999px;padding:4px 10px;font-size:.85rem;color:var(--muted)}
    .sr{position:absolute;width:1px;height:1px;margin:-1px;overflow:hidden;clip:rect(0,0,0,0)}
    @media (max-width:580px){.card{grid-template-columns:1fr}.thumb{max-height:220px}}
  </style>
</head>
<body class="nl">
  <main class="wrap" id="app" aria-busy="true">
    <h1>Newsletter</h1>
    <p class="sub">Latest articles, newest first.</p>
    <div id="list" class="grid" role="list"></div>
  </main>

  <script>
    (async function(){
      const $list = document.getElementById('list');
      const FALLBACK = '/newsletter/_common/assets/fallback.jpg';
      const source = '/newsletter/articles/manifest.json';

      try {
        const res = await fetch(source, {cache:'no-cache'});
        const items = await res.json();

        // sort newest → oldest by ISO date (YYYY-MM-DD)
        items.sort((a,b)=> (b.date || '').localeCompare(a.date || ''));

        $list.innerHTML = items.map(it => {
          const img = it.image || FALLBACK;
          const date = it.date ? new Date(it.date).toLocaleDateString() : '';
          const cats = (it.categories||[]).map(c=>`<span class="pill">${c}</span>`).join(' ');
          const url = `/newsletter/article.html?slug=${encodeURIComponent(it.slug)}${location.search ? '&ref='+encodeURIComponent(location.search.slice(1)) : ''}`;
          return `
            <article class="card" role="listitem">
              <img class="thumb" src="${img}" alt="${it.imageAlt || 'Article image'}"
                   onerror="this.onerror=null;this.src='${FALLBACK}'" />
              <div>
                <h2 class="title">${it.title || 'Untitled'}</h2>
                <div class="meta">
                  ${date ? `<time datetime="${it.date}">${date}</time>` : ''}
                  ${cats}
                </div>
                <p class="excerpt">${it.excerpt || ''}</p>
                <div class="row">
                  <a class="btn" href="${url}">Read more</a>
                </div>
              </div>
            </article>
          `;
        }).join('');

        document.getElementById('app').setAttribute('aria-busy','false');
      } catch (e){
        $list.innerHTML = `<p>Could not load articles.</p>`;
        console.error('Manifest load error', e);
      }
    })();
  </script>
</body>
</html>
