<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>Article | Competence Development</title>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>.date{font-size:.9rem;color:#6c757d}.badge-star::before{content:"â˜… ";}</style>
</head>
<body class="bg-light">
  <nav class="navbar bg-white border-bottom">
    <div class="container">
      <a class="navbar-brand fw-semibold" href="./">Volvo</a>
      <span class="navbar-text">Competence Development</span>
    </div>
  </nav>

  <main class="container py-4">
    <article id="article" class="mx-auto" style="max-width: 860px;"></article>
  </main>

  <script>
    const slug = new URLSearchParams(location.search).get('slug');
    const fmt = d => `${d.slice(0,4)}-${d.slice(4,6)}-${d.slice(6,8)}`;

    async function load(){
      if(!slug){ document.getElementById('article').innerHTML='<p>Missing slug.</p>'; return; }
      const r = await fetch(`./articles/${slug}.json`, {cache:'no-store'});
      if(!r.ok){ document.getElementById('article').innerHTML='<p>Article not found.</p>'; return; }
      render(await r.json());
    }

    function render(a){
      const chips = (a.categories||[]).map(c=>`<span class="badge text-bg-light border me-1">#${c}</span>`).join('');
      const root = document.getElementById('article');
      root.innerHTML = `
        <header class="mb-3">
          <h1 class="h3 ${a.featured?'badge-star':''}">${a.title}</h1>
          <div class="date">${fmt(a.date)}</div>
          <div class="mt-2">${chips}</div>
          ${a.hero?.image ? `<img class="img-fluid rounded mt-3" src="${a.hero.image}" alt="${a.hero.alt||''}">` : ``}
        </header>
        <section id="content"></section>`;
      const content = document.getElementById('content');
      (a.body||[]).forEach(b => content.appendChild(block(b)));
    }

    function block(b){
      switch(b.type){
        case 'p': { const p=document.createElement('p'); p.textContent=b.text||''; return p; }
        case 'h2': { const h=document.createElement('h2'); h.className='h5 mt-4'; h.textContent=b.text||''; return h; }
        case 'img': { const i=document.createElement('img'); i.src=b.src; i.alt=b.alt||''; i.className='img-fluid rounded my-3'; return i; }
        case 'video': { const v=document.createElement('video'); v.controls=true; v.src=b.src; if(b.poster) v.poster=b.poster; v.className='w-100 my-3 rounded'; return v; }
        case 'link': { const a=document.createElement('a'); a.href=b.href; a.textContent=b.text||b.href; a.target='_blank'; a.rel='noopener'; const p=document.createElement('p'); p.appendChild(a); return p; }
        case 'embed': { const d=document.createElement('div'); d.className='ratio ratio-16x9 my-3'; d.innerHTML=b.html; return d; }
        case 'ul': { const ul=document.createElement('ul'); (b.items||[]).forEach(t=>{const li=document.createElement('li'); li.textContent=t; ul.appendChild(li);}); return ul; }
        default: { const p=document.createElement('p'); p.textContent='[Unsupported block]'; return p; }
      }
    }

    load();
  </script>
</body>
</html>

